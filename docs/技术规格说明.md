# 技术规格说明书

## 1、前端框架

小程序是现在比较热门的一种移动端应用形式，跨平台且用户使用十分便利。为此我们选择将我们的应用开发在小程序上。小程序的前端框架我们选择了腾讯的wepy前端框架，该框架支持 npm 包，支持 css 预处理器，而且组件美观且有完整的指导文档，便于我们学习以及完成我们的开发任务。

## 2、后端框架

关于后端框架的选择，我们调研了基于python 的Django,Flask 框架，以及基于php 的ThinkPHP,基于java的JSP。最终我们选择了基于python语言的Django框架。愿意如下：

* Django封装较好，学习成本较低，并且功能齐全。我们组开发后端的人员中有的同学完全没有相关的开发经验，选择Django有助于他们快速上手，并完成我们的开发任务。
* 具有较强的数据库访问组件。我们可以方便的对数据库进行操作即使没有SQL语言的基础。
* admin interface. Django 拥有一个完整的后台管理界面。可视化界面简化了我们对后台数据的管理。
* Django 目前的文档已经相当完善，也易于我们学习。
## 3、前端技术

作为手机APP，页面是用户直接接触到的主要部分，也是前端的主要部分。合理的页面布局设计与页面跳转关系是确保用户体验的必要条件。

### 页面转换关系

页面的转换关系如下图，其中，矩形框表示具体页面，连线表示页面的跳转，线上文字表示触发跳转的用户动作。用户按下返回按键时，返回当前页面的上一级页面。当前页面上一级有多个页面时，由哪个页面进入当前页面，则返回哪个页面。

# 插入图片：APP页面转换图

### 页面布局设计

页面布局设计在功能规格说明书中有详细示意图，此处不再重复。设计的主要原则是尽量清晰简明的将该页面中的主要信息传达给用户。

## 4、数据库结构规格

- 数据库中需要存储用户数据、用户个人信息、帖子、申请4个实体，实体之间存在联系，实体也包含属性。联系、属性如下图所示：

## 5、接口规范

### 前端

- 欢迎和登陆页面 `/index/ `
- 注册页面`/register/`
- 发布总览页面` /f/processing/` 
  - 前端拿到未结束请求后一次展示10条（根据前端调整），在底端上拉展示下10条，在顶端下拉刷新。
  - <https://blog.csdn.net/qq_35713752/article/details/79016214> 
  - <https://www.cnblogs.com/simba-lkj/p/6274232.html> 
  - 每条展示：标题，详情前20字，（已用人数/需求人数），截止日期
- 已结束发布总览` /f/ending/ `（可添加）
- 搜索发布` /f/search/[<keyword>,<kind>]/ `(可添加)
- 发布详情` /p/<post_id>/ `
  - 展示发布所有内容
- 帖子收到的申请`/p/<post_id>/apply/`  
- 我的信息 `/my/<ID>/detail/`
- 我的帖子 `/my/<ID>/post/`
- 我的申请`/my/<ID>/apply/`
- 发布帖子`/c/post/`

### 前端需要要加入的功能

+ 微信小程序防止重复提交，（就一个按钮请求未响应时不能再点，防止请求被重复发送）
  + <https://blog.csdn.net/dt1991524/article/details/82585397> 
  + <https://blog.csdn.net/qappleh/article/details/84033766> 

### 后端

#### post 请求
##### /p/<post_id>/modify/   修改一个帖子的的信息，该帖子的发布者必须是当前登陆的用户 [已实现]

* parameter

  ```	
    {
        "title":"string",
        "postDetail":"string",
        "requestNum":"int",
        "ddl":"datetime", //YYYY-MM-DD
    }
  ```

* return 

  ```
  "ret":"bool", //是否修改成功
  "error_code": "int" 
  ```

  | error_code | 含义                                                         |
  | ---------- | ------------------------------------------------------------ |
  | 1          | 不是POST请求                                                 |
  | 2          | 缺少必要信息                                                 |
  | 3          | 信息格式错误                                                 |
  | 4          | post_id不存在              |
  | 5          | 用户未登录（未检测到token）或登录已过期（token过期）         |
  | 6          | post不属于当前用户         |

##### /login/ [已实现]

+ parameter  传入的参数，用post请求，前后端都要对传入的数据进行验证。

    ```
    {
        "account":"string", // 唯一,英文字母和数字，长度不超过14，以英文开头
        "password":"string"  // 数字大小写字母，标点符号，8~14个字符
    }
    ```

+ return

  ```
  {
      "ret":"bool", //是否登录成功
      "error_code": "int" //登录失败时返回
      "ID":"string", // 登录成功时返回，用户的唯一ID
      "Token":"string" //登录成功时返回，jwt
  }
  ```

  | error_code | 含义                 |
  | ---------- | -------------------- |
  | 1          | 不是POST请求         |
  | 2          | 缺少用户名或密码     |
  | 3          | 用户名或密码格式错误 |
  | 4          | 用户名不存在         |
  | 5          | 密码错误             |

一些关于token知识的网页<https://blog.leapoahead.com/2015/09/06/understanding-jwt/>

##### /register/ [已实现]

- parameter

  ```
  {
      "account":"string", // 唯一,英文字母和数字，长度不超过14，以英文开头
      "password":"string",  // 数字大小写字母，标点符号，8~14个字符
      "name":"string", //真实姓名，不超过20个字符
      "age":"int", //0~200
      "studentID":"string", //数字,不超过20个字符
      "sex":"string", // 男/女 下拉菜单或单选框
      "major":"string",// 下拉菜单选择系或专业
      "grade":"string" // 下拉菜单选择年级  //可以考虑输入学号后自动填入系和年级（可以加）
  }
  ```

- return

  ```
  {
      "ret":"bool", //是否注册成功
      "error_code": "int" //注册失败时返回
      "ID":"string", //注册成功时返回，用户的唯一ID
      "Token":"string" //注册成功时返回，jwt
  }
  ```

| error_code | 含义             |
| ---------- | ---------------- |
| 1          | 不是POST请求     |
| 2          | 缺少注册信息     |
| 3          | 注册信息格式错误 |
| 4          | 账号已存在       |



##### /my/profile/modify/  修改个人信息 [已实现]

- parameter

  ```
  {
      "account":"string", // 唯一,英文字母和数字，长度不超过14，以英文开头
      "name":"string", //真实姓名，不超过20个字符
      "age":"int", //0~200
      "studentID":"string", //数字,不超过20个字符
      "sex":"string", // 男/女 下拉菜单或单选框
      "major":"string",// 下拉菜单选择系或专业
      "grade":"string" // 下拉菜单选择年级  //可以考虑输入学号后自动填入系和年级（可以加）
  }
  ```

- return

  ```
  {
      "ret":"bool", //是否修改成功
      "error_code": "int" //修改失败时返回
  }
  ```

| error_code | 含义                                                 |
| ---------- | ---------------------------------------------------- |
| 1          | 不是POST请求                                         |
| 2          | 缺少个人信息                                          |
| 3          | 个人信息格式错误                                      |
| 4          | 账号（用户名）已存在                                  |
| 5          | 用户未登录（未检测到token）或登录已过期（token过期）    |


##### /my/change_password/  修改密码 [已实现]

- parameter

  ```
  {
      "password":"string",  // 数字大小写字母，标点符号，8~14个字符
      "new_password":"string",  // 数字大小写字母，标点符号，8~14个字符
  }
  ```

- return

  ```
  {
      "ret":"bool", //是否修改成功
      "error_code": "int" //修改失败时返回
  }
  ```

| error_code | 含义                                                 |
| ---------- | ---------------------------------------------------- |
| 1          | 不是POST请求                                         |
| 2          | 缺少必要信息                                         |
| 3          | 密码格式错误                                     |
| 4          | 旧密码错误                                                |
| 5          | 用户未登录（未检测到token）或登录已过期（token过期）   |




##### /c/post/  发布帖子 [已实现]

- header
  
  ```
  {
      "Authorization": "Token值"
  }
  ```
  
- parameter
  
  ```
    {
        "title":"string", //标题  : 20字符之内 （可以根据前端需求调整）
        "postDetail":"string",//内容 : text类型，无字数限制
        "requestNum":"int", //所需人数 : >0
        "ddl":"datetime", //结束时间 ：以 YYYY-MM-DD 的形式传递
    }
  ```

- return

  ```
  {
      "ret":"bool", //是否发布成功 True，False
      "postID":"string", // 帖子ID
      "error_code":"int",//发布失败时返回
  }
  ```
  | error_code | 含义                                                         |
  | ---------- | ------------------------------------------------------------ |
  | 1          | 不是POST请求                                                 |
  | 2          | 缺少必要信息                                                 |
  | 3          | 信息格式错误                                                 |
  | 4          | 帖子已存在，判断title，postDetail，requestNum，ddl，posterID都一样时为已存在 |
  | 5          | 用户未登录（未检测到token）或登录已过期（token过期）         |




##### /my/resume/modify/  修改个人简历

- parameter

  ```
  {
      "name":"string",  # 不超过20个字符
      "sex":"string", # 不超过20个字符
      "age":"int", # 0~200
      "degree": "string", # 学历，不超过20个字符
      "phone":"string", # 不超过20个字符
      "email":"string", # 不超过254个字符，需符合邮箱格式
      "city":"string", # 不超过120个字符
      "edu_exp":"string", # 经历内部以&分割，经历之间以|分割
      "awards":"string", 
      "english_skill":"string",
      "project_exp":"string",
      "self_review":"string"
       }
  ```

- return

  ```
  {
      "ret":"bool", //是否修改成功
      "error_code": "int" //修改失败时返回
  }
  ```

| error_code | 含义                                                 |
| ---------- | ---------------------------------------------------- |
| 1          | 不是POST请求                                         |
| 2          | 缺少信息                                          |
| 3          | 信息格式错误                                      |
| 5          | 用户未登录（未检测到token）或登录已过期（token过期）    |




##### /c/apply/ 提交申请，同时将简历的更改同步到个人简历中

- parameter

  ```
  {
      "post_id":"string",  # 申请对应的帖子ID
      "name":"string",  # 不超过20个字符
      "sex":"string", # 不超过20个字符
      "age":"int", # 0~200
      "degree": "string", # 学历，不超过20个字符
      "phone":"string", # 不超过20个字符
      "email":"string", # 不超过254个字符，需符合邮箱格式
      "city":"string", # 不超过120个字符
      "edu_exp":"string", # 经历内部以&分割，经历之间以|分割
      "awards":"string", 
      "english_skill":"string",
      "project_exp":"string",
      "self_review":"string"
       }
  ```

- return

  ```
  {
      "ret":"bool", //是否申请成功
      "error_code": "int" //申请失败时返回
  }
  ```

| error_code | 含义                                                 |
| ---------- | ---------------------------------------------------- |
| 1          | 不是POST请求                                         |
| 2          | 缺少信息                                          |
| 3          | 信息格式错误                                      |
| 4          | 该帖子的已接收（同意）人数已经达到所需人数           |
| 5          | 用户未登录（未检测到token）或登录已过期（token过期）    |


##### /apply/<apply_id>/accept/ 同意申请，当前登录用户必须是该申请对应帖子的发布者，当该帖子已同意人数达到所需人数时会自动将其他申请的状态改为closed，并不再接收新的申请

- parameter

  ```
  {
  }
  ```

- return

  ```
  {
      "ret":"bool", //是否同意成功
      "error_code": "int" //未成功时返回
  }
  ```

| error_code | 含义                                                 |
| ---------- | ---------------------------------------------------- |
| 1          | 不是POST请求                                         |
| 2          | 该apply_id对应的申请不存在                            |
| 3          | 当前登录用户不是是该申请的接收者                        |
| 5          | 用户未登录（未检测到token）或登录已过期（token过期）    |



#### get请求


##### /GetLoginStatus/  检查header中得token返回登陆状态是否已经登陆 [已实现]


- return

  ```
  {
      "ret":"bool", //是否已经登陆过
  }
  ```

##### /my/profile/ 获取当前登录用户的全部个人信息 [已实现]

- return

  ```
  {
      "ret":"bool",//是否获取成功
      "error_code":"int",//获取失败时返回
      "account":"string", // 唯一,英文字母和数字，长度不超过14，以英文开头
      "name":"string", //真实姓名，不超过20个字符
      "age":"int", //0~200
      "studentID":"string", //数字,不超过20个字符
      "sex":"string", // 男/女 下拉菜单或单选框
      "major":"string",// 下拉菜单选择系或专业
      "grade":"string" // 下拉菜单选择年级  //可以考虑输入学号后自动填入系和年级（可以加）
  }
  ```

  | error_code | 含义                                                 |
  | ---------- | ---------------------------------------------------- |
  | 1          | 不是GET请求                                          |
  | 5          | 用户未登录（未检测到token）或登录已过期（token过期） |


##### /f/processing/ 获取所有未结束请求，按时间先后顺序，时间最近的在第一条 [已实现]

- return

  ```
  [
      {
          "title":"string",
          "postDetail":"string",
          "requestNum":"int",
          "acceptedNum":"int", //目前已经接收的人数
          "ddl":"datetime", //YYYY-MM-DD
          "postID":"string",
          "posterID":"string",
  	},
      ...
  ]
  ```

 请求失败时返回
  
  ```
    {
        "ret": false,
        "error_code":"int",//获取失败时返回
  	}
  ```
  
  | error_code | 含义                                                 |
  | ---------- | ---------------------------------------------------- |
  | 1          | 不是GET请求                                          |
  | 5          | 当前用户未登录（未检测到token）或登录已过期（token过期） |

##### /p/<post_id>/ 获取该帖子的详情 [已实现]

- return

  ```
    {
        "ret":"bool",//是否获取成功
        "error_code":"int",//获取失败时返回
        "title":"string",
        "postDetail":"string",
        "requestNum":"int",
        "acceptedNum":"int",
        "ddl":"datetime", //YYYY-MM-DD
        "ifEnd":"bool",
        "postID":"string",
        "posterID":"string",
  	}
  ```
| error_code | 含义                                                 |
| ---------- | ---------------------------------------------------- |
| 1          | 不是GET请求                                          |
| 3          | 贴子不存在                                           |
| 5          | 用户未登录（未检测到token）或登录已过期（token过期）     |

##### /p/<post_id>/apply/ 获取该帖子收到的所有申请（不返回简历信息） [已实现]

- return 

  ```
   [
       {
        "applyID":"string",
        "applyStatus":"string", //接受（accepted），待定（pending），结束（closed）
        "applicantID":"string",
        "applicant_account":"string",
  	},
       ...
   ]
  ```

 请求失败时返回
  
  ```
    {
        "ret": false,
        "error_code":"int",//获取失败时返回
  	}
  ```
  
  | error_code | 含义                                                 |
  | ---------- | ---------------------------------------------------- |
  | 1          | 不是GET请求                                          |
  | 3          | 贴子不存在                                  |
  | 5          | 当前用户未登录（未检测到token）或登录已过期（token过期） |

##### /my/\<ID\>/detail/ 获取该ID的用户的全部个人信息 [已实现]

- return

  ```
  {
      "ret":"bool",//是否获取成功
      "error_code":"int",//获取失败时返回
      "account":"string", // 唯一,英文字母和数字，长度不超过14，以英文开头
      "name":"string", //真实姓名，不超过20个字符
      "age":"int", //0~200
      "studentID":"string", //数字,不超过20个字符
      "sex":"string", // 男/女 下拉菜单或单选框
      "major":"string",// 下拉菜单选择系或专业
      "grade":"string" // 下拉菜单选择年级  //可以考虑输入学号后自动填入系和年级（可以加）
  }
  ```

  | error_code | 含义                                                 |
  | ---------- | ---------------------------------------------------- |
  | 1          | 不是GET请求                                          |
  | 3          | 该 ID 对应的用户不存在                                 |
  | 5          | 当前用户未登录（未检测到token）或登录已过期（token过期） |


##### /my/\<ID\>/post/ 获取该ID的用户的全部发布[已实现]

- return

  ```
  [
      {
          "title":"string",
          "postDetail":"string",
          "requestNum":"int",
          "acceptedNum":"int",
          "ddl":"datetime", //YYYY-MM-DD
          "ifEnd":"bool",
          "postID":"string",
          "posterID":"string",
  	},
      ...
  ]
  ```
  
  请求失败时返回
  
  ```
    {
        "ret": false,
        "error_code":"int",//获取失败时返回
  	}
  ```
  
  | error_code | 含义                                                 |
  | ---------- | ---------------------------------------------------- |
  | 1          | 不是GET请求                                          |
  | 3          | 该 ID 对应的用户不存在                                 |
  | 5          | 当前用户未登录（未检测到token）或登录已过期（token过期） |


##### /my/\<ID\>/apply/ 获取该ID的用户的全部申请（不返回简历信息） [已实现]

- return

  ```
   [
       {
        "applyID":"string",
        "applyStatus":"string", //接受（accepted），待定（pending），结束（closed）
        "postID":"string",
        "post_title":"string",
  	},
       ...
   ]
  ```
  
 请求失败时返回
  
  ```
    {
        "ret": false,
        "error_code":"int",//获取失败时返回
  	}
  ```
  
  | error_code | 含义                                                 |
  | ---------- | ---------------------------------------------------- |
  | 1          | 不是GET请求                                          |
  | 3          | 该 ID 对应的用户不存在                                 |
  | 5          | 当前用户未登录（未检测到token）或登录已过期（token过期） |



##### /apply/<apply_id>/ 获取一个申请的状态及简历信息，当前登录用户必须是该申请的发布者或接收者

- return

  ```
  {
      "ret":"bool",//是否获取成功
      "applyStatus":"string", //接受（accepted），待定（pending），结束（closed）
      
      "name":"string",  # 不超过20个字符
      "sex":"string", # 不超过20个字符
      "age":"int", # 0~200
      "degree": "string", # 学历，不超过20个字符
      "phone":"string", # 不超过20个字符
      "email":"string", # 不超过254个字符，需符合邮箱格式
      "city":"string", # 不超过120个字符
      "edu_exp":"string", # 经历内部以&分割，经历之间以|分割
      "awards":"string", 
      "english_skill":"string",
      "project_exp":"string",
      "self_review":"string"
  }
  ```

  | error_code | 含义                                                 |
  | ---------- | ---------------------------------------------------- |
  | 1          | 不是GET请求                                          |
  | 2          | 该apply_id对应的申请不存在                                 |
  | 3          | 当前登录用户不是该申请的发布者或接收者               |
  | 5          | 用户未登录（未检测到token）或登录已过期（token过期） |



##### /my/resume/ 获取当前登录用户的个人简历

- return

  ```
  {
      "ret":"bool",//是否获取成功
      "name":"string",  # 不超过20个字符
      "sex":"string", # 不超过20个字符
      "age":"int", # 0~200
      "degree": "string", # 学历，不超过20个字符
      "phone":"string", # 不超过20个字符
      "email":"string", # 不超过254个字符，需符合邮箱格式
      "city":"string", # 不超过120个字符
      "edu_exp":"string", # 经历内部以&分割，经历之间以|分割
      "awards":"string", 
      "english_skill":"string",
      "project_exp":"string",
      "self_review":"string"
  }
  ```

  | error_code | 含义                                                 |
  | ---------- | ---------------------------------------------------- |
  | 1          | 不是GET请求                                          |
  | 3          | 当前用户未设置简历                                     |
  | 5          | 用户未登录（未检测到token）或登录已过期（token过期） |





## 6、错误处理

我们定义错误处理类，对错误进行分类汇总，集中处理，目前暂时分为如下几大类，具体的细化会在开发的时候逐渐扩充。
* InvalidInputError: 处理不合理的输入，比如用户名，密码中的不合理的字符以及发布需求的时候，填入不合法的人数，截至日期等等。
* DataOverflowError: 防止用户输入大量的数据导致程序崩溃，限制用户的输入的长度并且抛出异常。
* FrequentRefreshError: 用户如果过于频发刷新，抛出异常并在一定时间内禁止刷新，防止app崩溃
## 7、应对变化的灵活性
我们将功能抽象成独立的接口，前端UI操作与后端响应函数与数据管理十分独立，程序每个页面之间的实现也互相独立，程序具有良好的扩展性以及应对变化的能力。
## 8、抗压能力
拥有较好的异常处理机制防止程序崩溃，对于模拟大量用户同时操作的压力测试目前还没有做。






